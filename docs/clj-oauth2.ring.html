<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>clj-oauth2.ring documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Clj-oauth2</span> <span class="project-version">0.7.2</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>clj-oauth2</span></div></div></li><li class="depth-2 branch"><a href="clj-oauth2.OAuth2Exception.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>OAuth2Exception</span></div></a></li><li class="depth-2 branch"><a href="clj-oauth2.OAuth2StateMismatchException.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>OAuth2StateMismatchException</span></div></a></li><li class="depth-2 branch"><a href="clj-oauth2.client.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>client</span></div></a></li><li class="depth-2 current"><a href="clj-oauth2.ring.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>ring</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="clj-oauth2.ring.html#var-accept-html.3F"><div class="inner"><span>accept-html?</span></div></a></li><li class="depth-1"><a href="clj-oauth2.ring.html#var-authenticated-callback.3F"><div class="inner"><span>authenticated-callback?</span></div></a></li><li class="depth-1"><a href="clj-oauth2.ring.html#var-clear-oauth2-data-in-session"><div class="inner"><span>clear-oauth2-data-in-session</span></div></a></li><li class="depth-1"><a href="clj-oauth2.ring.html#var-excluded.3F"><div class="inner"><span>excluded?</span></div></a></li><li class="depth-1"><a href="clj-oauth2.ring.html#var-failed-refresh-response"><div class="inner"><span>failed-refresh-response</span></div></a></li><li class="depth-1"><a href="clj-oauth2.ring.html#var-get-oauth2-data-from-session"><div class="inner"><span>get-oauth2-data-from-session</span></div></a></li><li class="depth-1"><a href="clj-oauth2.ring.html#var-get-state-from-session"><div class="inner"><span>get-state-from-session</span></div></a></li><li class="depth-1"><a href="clj-oauth2.ring.html#var-get-target-from-session"><div class="inner"><span>get-target-from-session</span></div></a></li><li class="depth-1"><a href="clj-oauth2.ring.html#var-handle-authenticated-callback"><div class="inner"><span>handle-authenticated-callback</span></div></a></li><li class="depth-1"><a href="clj-oauth2.ring.html#var-oauth2-logout-callback-handler"><div class="inner"><span>oauth2-logout-callback-handler</span></div></a></li><li class="depth-1"><a href="clj-oauth2.ring.html#var-put-oauth2-data-in-session"><div class="inner"><span>put-oauth2-data-in-session</span></div></a></li><li class="depth-1"><a href="clj-oauth2.ring.html#var-put-state-in-session"><div class="inner"><span>put-state-in-session</span></div></a></li><li class="depth-1"><a href="clj-oauth2.ring.html#var-put-target-in-session"><div class="inner"><span>put-target-in-session</span></div></a></li><li class="depth-1"><a href="clj-oauth2.ring.html#var-redirect-to-authentication-server"><div class="inner"><span>redirect-to-authentication-server</span></div></a></li><li class="depth-1"><a href="clj-oauth2.ring.html#var-refresh-token-error"><div class="inner"><span>refresh-token-error</span></div></a></li><li class="depth-1"><a href="clj-oauth2.ring.html#var-store-data-in-session"><div class="inner"><span>store-data-in-session</span></div></a></li><li class="depth-1"><a href="clj-oauth2.ring.html#var-update-oauth2-data"><div class="inner"><span>update-oauth2-data</span></div></a></li><li class="depth-1"><a href="clj-oauth2.ring.html#var-wrap-add-oauth-data"><div class="inner"><span>wrap-add-oauth-data</span></div></a></li><li class="depth-1"><a href="clj-oauth2.ring.html#var-wrap-authenticated-callback"><div class="inner"><span>wrap-authenticated-callback</span></div></a></li><li class="depth-1"><a href="clj-oauth2.ring.html#var-wrap-logout"><div class="inner"><span>wrap-logout</span></div></a></li><li class="depth-1"><a href="clj-oauth2.ring.html#var-wrap-logout-callback"><div class="inner"><span>wrap-logout-callback</span></div></a></li><li class="depth-1"><a href="clj-oauth2.ring.html#var-wrap-oauth2"><div class="inner"><span>wrap-oauth2</span></div></a></li><li class="depth-1"><a href="clj-oauth2.ring.html#var-wrap-redirect-unauthenticated"><div class="inner"><span>wrap-redirect-unauthenticated</span></div></a></li><li class="depth-1"><a href="clj-oauth2.ring.html#var-wrap-validate-oauth-data"><div class="inner"><span>wrap-validate-oauth-data</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">clj-oauth2.ring</h1><div class="doc"><pre class="plaintext"></pre></div><div class="public anchor" id="var-accept-html.3F"><h3>accept-html?</h3><div class="usage"><code>(accept-html? request)</code></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-authenticated-callback.3F"><h3>authenticated-callback?</h3><div class="usage"><code>(authenticated-callback? request oauth2-params)</code></div><div class="doc"><pre class="plaintext">Checks if the request uri matches the configured authenticated callback uri
</pre></div></div><div class="public anchor" id="var-clear-oauth2-data-in-session"><h3>clear-oauth2-data-in-session</h3><div class="usage"><code>(clear-oauth2-data-in-session request response)</code></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-excluded.3F"><h3>excluded?</h3><div class="usage"><code>(excluded? request exclusion)</code></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-failed-refresh-response"><h3>failed-refresh-response</h3><div class="usage"><code>(failed-refresh-response request oauth2-params)</code></div><div class="doc"><pre class="plaintext">Returned when refreshing the tokens fails. Dependning on the accept header, either redirect the user to
login again with the authentication server or return a 400 error</pre></div></div><div class="public anchor" id="var-get-oauth2-data-from-session"><h3>get-oauth2-data-from-session</h3><div class="usage"><code>(get-oauth2-data-from-session request)</code></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-get-state-from-session"><h3>get-state-from-session</h3><div class="usage"><code>(get-state-from-session request)</code></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-get-target-from-session"><h3>get-target-from-session</h3><div class="usage"><code>(get-target-from-session request)</code></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-handle-authenticated-callback"><h3>handle-authenticated-callback</h3><div class="usage"><code>(handle-authenticated-callback request oauth2-params)</code></div><div class="doc"><pre class="plaintext">This Ring wrapper acts as a filter, ensuring that the user has an OAuth
token for all but a set of explicitly excluded URLs. The response from
oauth2/get-access-token is exposed in the request via the :oauth2 key.
Requires ring.middleware.params/wrap-params and
ring.middleware.keyword-params/wrap-keyword-params to have been called
first.</pre></div></div><div class="public anchor" id="var-oauth2-logout-callback-handler"><h3>oauth2-logout-callback-handler</h3><div class="usage"><code>(oauth2-logout-callback-handler req)</code><code>(oauth2-logout-callback-handler req redirect-url)</code></div><div class="doc"><pre class="plaintext">Ring handler that removes the oauth2 data from the session and redirects to the specified route, or to / if
no redirect-url specified.</pre></div></div><div class="public anchor" id="var-put-oauth2-data-in-session"><h3>put-oauth2-data-in-session</h3><div class="usage"><code>(put-oauth2-data-in-session request response oauth2-data)</code></div><div class="doc"><pre class="plaintext">Put the oauth2 data in the :session key, either from the response or the request.

Note that if there was a failure to refresh the access token, then the :session is not set in the response.
The reason for that is to avoid updating the session with expired tokens.</pre></div></div><div class="public anchor" id="var-put-state-in-session"><h3>put-state-in-session</h3><div class="usage"><code>(put-state-in-session response state)</code></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-put-target-in-session"><h3>put-target-in-session</h3><div class="usage"><code>(put-target-in-session response target)</code></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-redirect-to-authentication-server"><h3>redirect-to-authentication-server</h3><div class="usage"><code>(redirect-to-authentication-server request oauth2-params)</code></div><div class="doc"><pre class="plaintext">Returns a redirect to the authentication server
</pre></div></div><div class="public anchor" id="var-refresh-token-error"><h3>refresh-token-error</h3><div class="usage"><code>(refresh-token-error)</code></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-store-data-in-session"><h3>store-data-in-session</h3><div class="usage"></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-update-oauth2-data"><h3>update-oauth2-data</h3><div class="usage"><code>(update-oauth2-data request oauth2-data)</code></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-wrap-add-oauth-data"><h3>wrap-add-oauth-data</h3><div class="usage"><code>(wrap-add-oauth-data handler oauth2-params)</code></div><div class="doc"><pre class="plaintext">Adds :oauth2 key to the request
</pre></div></div><div class="public anchor" id="var-wrap-authenticated-callback"><h3>wrap-authenticated-callback</h3><div class="usage"><code>(wrap-authenticated-callback handler oauth2-params)</code></div><div class="doc"><pre class="plaintext">Handles authentication callbacks from the authorization server
</pre></div></div><div class="public anchor" id="var-wrap-logout"><h3>wrap-logout</h3><div class="usage"><code>(wrap-logout handler {:keys [logout-client-path logout-uri]})</code></div><div class="doc"><pre class="plaintext">Logs the client out of the authorization server session if the request is to the local logout URI
</pre></div></div><div class="public anchor" id="var-wrap-logout-callback"><h3>wrap-logout-callback</h3><div class="usage"><code>(wrap-logout-callback handler {:keys [logout-callback-fn logout-callback-path]})</code></div><div class="doc"><pre class="plaintext">Handles logout callbacks from the authorization server to log the user out of the local session as well
</pre></div></div><div class="public anchor" id="var-wrap-oauth2"><h3>wrap-oauth2</h3><div class="usage"><code>(wrap-oauth2 handler oauth2-params)</code></div><div class="doc"><pre class="plaintext">Handles oauth2 requests for
- authorization redirects from the authorization server
- client logout
- logout redirects from the authorization server
- validating access tokens against the authorization server on every request
- refreshing access tokens that expire

Requests are delegated to the handler directly if the uri is excluded/blacklisted or when
the :get-oauth2-data function does not return oauth data.

If there is oauth data, then it is added to the request/response with the :oauth2 key</pre></div></div><div class="public anchor" id="var-wrap-redirect-unauthenticated"><h3>wrap-redirect-unauthenticated</h3><div class="usage"><code>(wrap-redirect-unauthenticated handler oauth2-params)</code></div><div class="doc"><pre class="plaintext">Redirects to the authorization server when the request is not authenticated.
Note that this wrapper only makes sense for requests that are initiated by a user, i.e not for XHR-requests.
Requires the wrap-oauth2 to have been called first.</pre></div></div><div class="public anchor" id="var-wrap-validate-oauth-data"><h3>wrap-validate-oauth-data</h3><div class="usage"><code>(wrap-validate-oauth-data handler oauth2-params)</code></div><div class="doc"><pre class="plaintext">Validates the request according to the Oauth contract

Note:
- requests to excluded URIs are skipped
- only requests with oauth2-data are validated

Validation implies the following:
- Checking the validity of the access token against the authorization server API
- Attempting to refresh the access token in the case it has expired</pre></div></div></div></body></html>